{% extends 'base.html' %}

{% block title %}Панель управления{% endblock %}

{% block content %}
<section>
    <h1>Избранные активы</h1>
    {% if favorite_assets %}
    <div class="cards">
        {% for asset in favorite_assets %}
        <article>
            <h3>{{ asset.name }} ({{ asset.ticker }})</h3>
            <p>
                Текущая цена:
                {% if asset.current_price %}
                {{ asset.current_price|floatformat:2 }} USD
                {% else %}
                —
                {% endif %}
            </p>
            <p>
                Изменение 24ч:
                {% if asset.change_24h is not None %}
                <span
                    class="{% if asset.change_24h > 0 %}text-green{% elif asset.change_24h < 0 %}text-red{% else %}text-neutral{% endif %}">
                    {{ asset.change_24h|floatformat:2 }}%
                </span>
                {% else %}
                —
                {% endif %}
            </p>
        </article>
        {% endfor %}
    </div>
    {% else %}
    <p>Добавьте активы в избранное, чтобы отслеживать их.</p>
    {% endif %}
</section>

<section>
    <h2>Персонализированные прогнозы</h2>
    {% if personalized_predictions %}
    <h3>Прогнозы на 7 дней</h3>
    <h4>Акции</h4>
    {% if stock_preds_7d %}
    <div class="cards">
        {% for prediction in stock_preds_7d %}
        <article>
            <h3>{{ prediction.asset.name }} ({{ prediction.asset.ticker }})</h3>
            <p>Горизонт: {{ prediction.get_horizon_display }}</p>
            <p>
                Прогноз изменения:
                {% if prediction.change_percent is not None %}
                <span
                    class="{% if prediction.direction == 'up' %}text-green{% elif prediction.direction == 'down' %}text-red{% else %}text-neutral{% endif %}">
                    {{ prediction.change_percent|floatformat:2 }}%
                    {% if prediction.direction == 'up' %}↑{% elif prediction.direction == 'down' %}↓{% endif %}
                </span>
                {% else %}<span>—</span>{% endif %}
            </p>
            <p>Доверие модели: {{ prediction.confidence|floatformat:2 }}</p>
            <small>Модель: {{ prediction.model_version }}</small>
        </article>
        {% endfor %}
    </div>
    {% else %}<p>Нет прогнозов для акций.</p>{% endif %}

    <h4>Криптовалюты</h4>
    {% if crypto_preds_7d %}
    <div class="cards">
        {% for prediction in crypto_preds_7d %}
        <article>
            <h3>{{ prediction.asset.name }} ({{ prediction.asset.ticker }})</h3>
            <p>Горизонт: {{ prediction.get_horizon_display }}</p>
            <p>
                Прогноз изменения:
                {% if prediction.change_percent is not None %}
                <span
                    class="{% if prediction.direction == 'up' %}text-green{% elif prediction.direction == 'down' %}text-red{% else %}text-neutral{% endif %}">
                    {{ prediction.change_percent|floatformat:2 }}%
                    {% if prediction.direction == 'up' %}↑{% elif prediction.direction == 'down' %}↓{% endif %}
                </span>
                {% else %}<span>—</span>{% endif %}
            </p>
            <p>Доверие модели: {{ prediction.confidence|floatformat:2 }}</p>
            <small>Модель: {{ prediction.model_version }}</small>
        </article>
        {% endfor %}
    </div>
    {% else %}<p>Нет прогнозов для криптовалют.</p>{% endif %}

    <h3>Прогнозы на 30 дней</h3>
    <h4>Акции</h4>
    {% if stock_preds_30d %}
    <div class="cards">
        {% for prediction in stock_preds_30d %}
        <article>
            <h3>{{ prediction.asset.name }} ({{ prediction.asset.ticker }})</h3>
            <p>Горизонт: {{ prediction.get_horizon_display }}</p>
            <p>
                Прогноз изменения:
                {% if prediction.change_percent is not None %}
                <span
                    class="{% if prediction.direction == 'up' %}text-green{% elif prediction.direction == 'down' %}text-red{% else %}text-neutral{% endif %}">
                    {{ prediction.change_percent|floatformat:2 }}%
                    {% if prediction.direction == 'up' %}↑{% elif prediction.direction == 'down' %}↓{% endif %}
                </span>
                {% else %}<span>—</span>{% endif %}
            </p>
            <p>Доверие модели: {{ prediction.confidence|floatformat:2 }}</p>
            <small>Модель: {{ prediction.model_version }}</small>
        </article>
        {% endfor %}
    </div>
    {% else %}<p>Нет прогнозов для акций.</p>{% endif %}

    <h4>Криптовалюты</h4>
    {% if crypto_preds_30d %}
    <div class="cards">
        {% for prediction in crypto_preds_30d %}
        <article>
            <h3>{{ prediction.asset.name }} ({{ prediction.asset.ticker }})</h3>
            <p>Горизонт: {{ prediction.get_horizon_display }}</p>
            <p>
                Прогноз изменения:
                {% if prediction.change_percent is not None %}
                <span
                    class="{% if prediction.direction == 'up' %}text-green{% elif prediction.direction == 'down' %}text-red{% else %}text-neutral{% endif %}">
                    {{ prediction.change_percent|floatformat:2 }}%
                    {% if prediction.direction == 'up' %}↑{% elif prediction.direction == 'down' %}↓{% endif %}
                </span>
                {% else %}<span>—</span>{% endif %}
            </p>
            <p>Доверие модели: {{ prediction.confidence|floatformat:2 }}</p>
            <small>Модель: {{ prediction.model_version }}</small>
        </article>
        {% endfor %}
    </div>
    {% else %}<p>Нет прогнозов для криптовалют.</p>{% endif %}

    {% else %}
    <p>Добавьте активы в избранное, чтобы видеть прогнозы.</p>
    {% endif %}
</section>


{% endblock %}